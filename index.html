<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="./style.css" />
    <title>Simple Web Sandbox</title>
  </head>
  <body>
    <div class="container-fluid vh-100">
      <div class="row h-100">
        <div class="col-6 p-0 d-flex flex-column">
          <div class="row">
            <div class="col-12">
              <select id="langSelect" class="form-select text-center" onchange="selectLang()">
                <option selected value="html">HTML</option>
                <option value="css">CSS</option>
              </select>
            </div>
          </div>
          <div class="row flex-grow-1">
            <div class="col-12">
              <textarea class="w-100 h-100 border" id="input-html" oninput="update()"></textarea>
              <textarea class="w-100 h-100 border" id="input-css" oninput="update()"></textarea>
            </div>
          </div>
        </div>

        <div class="col-6 p-0 d-flex flex-column">
          <div class="row m-0">
            <div class="col-12 border">
              <p class="w-100 mt-1 mb-2 text-center">Result:</p>
            </div>
          </div>
          <div class="row flex-grow-1">
            <div class="col-12">
              <iframe class="w-100 h-100 p-1 border" id="output"></iframe>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>

  <script>
    const inputHtml = document.querySelector("#input-html");
    const inputCss = document.querySelector("#input-css");
    const langSelect = document.querySelector("#langSelect");

    function start() {
      const urlParams = new URLSearchParams(window.location.search);

      const htmlParam = urlParams.get("html");
      const cssParam = urlParams.get("css");
      const lang = urlParams.get("lang");

      if (htmlParam) {
        inputHtml.value = htmlParam;
      }

      if (cssParam) {
        inputCss.value = cssParam;
      }

      if (lang == "html" || lang == "css") {
        langSelect.value = lang;
      }

      selectLang();
      update();

      enableTab("#input-html");
      enableTab("#input-css");
    }

    function update() {
      output.contentDocument.open();
      output.contentDocument.write(`<style>${inputCss.value}</style>`);
      output.contentDocument.write(inputHtml.value);
      output.contentDocument.close();
    }

    function selectLang() {
      value = langSelect.value;

      switch (value) {
        case "html":
          inputHtml.removeAttribute("hidden");
          inputCss.setAttribute("hidden", "true");
          break;

        case "css":
          inputCss.removeAttribute("hidden");
          inputHtml.setAttribute("hidden", "true");
          break;

        default:
          break;
      }
    }

    function enableTab(query) {
      const el = document.querySelector(query);
      el.onkeydown = function (e) {
        if (e.keyCode === 9) {
          const val = this.value;
          const start = this.selectionStart;
          const end = this.selectionEnd;

          this.value = val.substring(0, start) + "\t" + val.substring(end);
          this.selectionStart = this.selectionEnd = start + 1;

          return false;
        }
      };
    }

    start();
  </script>
</html>
